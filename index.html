<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
 <link href='https://fonts.googleapis.com/css?family=Libre+Baskerville' rel='stylesheet'>

   <title>STADENS POESI - en vandring till åtta dikter
av
STIG SJÖDIN
    
  </title>
  <style>
  




    :root {
      --base-font-size: 16px;
      --font-family-sans: Arial, Helvetica, sans-serif;
      --font-family-serif: "Libre Baskerville", Georgia, serif;
      --accent-blue: #1a73e8;
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: var(--font-family-sans);
      font-size: var(--base-font-size);
      line-height: 1.5;
      color: #222;
    }

    h1 {
      font-size: clamp(1.8rem, 2.5vw + 1rem, 3rem);
      margin: 0.5rem 0;
    }
    h2 {
      font-size: clamp(1.25rem, 1.2vw + 0.8rem, 1.75rem);
      margin: 0.25rem 0 0.5rem 0;
    }
    p { font-size: 1rem; margin: 0.4rem 0; }

    #googleMap {
      height: 100%;
      width: 100%;
    }

    .gm-style-iw {
      max-width: min(420px, 80vw);
    }

    .poem {
      font-family: var(--font-family-serif);
      white-space: pre-wrap;
      margin-top: 0.5rem;
    }
    .poem-wrap {
      max-height: 0;
      overflow: hidden;
      transition: max-height .4s ease;
    }

    .toggle-poem, .route-to {
      display: inline-block;
      margin-top: 0.5rem;
      color: #1565c0;
      text-decoration: none;
      font-weight: 600;
    }
    .toggle-poem:focus, .toggle-poem:hover,
    .route-to:focus, .route-to:hover {
      text-decoration: underline;
    }

    /* Enkel kontroll-knapp på kartan */
    .map-control {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 0.95rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      cursor: pointer;
      user-select: none;
    }
    .map-control:hover {
      background: #f7f7f7;
    }

    @media (prefers-color-scheme: dark) {
      html, body { color: #eee; background: #111; }
      .map-control { background: #222; color: #eee; border-color: #444; }
    }

  </style>
</head>
<body>
 <div id="googleMap"></div>
  <script>
   
let map;
    let infoWindow;
    let bounds;

    // Enhetsposition
    let userPos = null;
    let userMarker = null;
    let accuracyCircle = null;

    // Vägbeskrivning (gång)
    let directionsService = null;
    let directionsRenderer = null;

    function initMap() {
      map = new google.maps.Map(document.getElementById("googleMap"), {
        center: { lat: 60.6189135, lng: 16.7788006 },
        zoom: 15,
        clickableIcons: false,
        styles: [
          { featureType: "landscape.man_made", elementType: "geometry", stylers: [{ color: "#5D4037" }] },
          { featureType: "poi", elementType: "geometry", stylers: [{ color: "#5D4037" }] },
          { featureType: "poi", elementType: "labels.text.fill", stylers: [{ color: "#3E2723" }] },
          { featureType: "water", elementType: "geometry", stylers: [{ color: "#a0c8f0" }] },
          { featureType: "park", elementType: "geometry", stylers: [{ color: "#c5e1a5" }] },
          { featureType: "road", elementType: "geometry", stylers: [{ color: "#ffffff" }] },
          { featureType: "poi.business", stylers: [{ visibility: "off" }] },
          { featureType: "road", elementType: "labels", stylers: [{ visibility: "on" }] },
          { featureType: "poi.place_of_worship", stylers: [{ visibility: "on" }] },
          { featureType: "poi.school", stylers: [{ visibility: "on" }] },
          { featureType: "poi.government", stylers: [{ visibility: "on" }] },
          { featureType: "poi.medical", stylers: [{ visibility: "on" }] },
          { featureType: "poi", elementType: "labels.text", stylers: [{ visibility: "on" }] }
        ]
      });

      infoWindow = new google.maps.InfoWindow();
      bounds = new google.maps.LatLngBounds();

      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({
        map,
        suppressMarkers: false,
        preserveViewport: false,
        polylineOptions: { strokeColor: "#1976d2", strokeWeight: 5, strokeOpacity: 0.8 }
      });


      const markers = [
  {
    number: 1,
    lat: 60.6223,
    lng: 16.7836,
    title: "Andakt",
    description:
      "Dikten Andakt, invid nordvästra murresten av Sandvikens gamla kyrka, ingår i diktsamlingen ”Har ni flaggproblem?” (1970).",
    poem: `Den gamle ställer velocipeden mot slaggstensfoten,
det enda som är kvar av den första kyrkan.
Sen går han in under valv som når in i himlen.
Jag stjäl mig till hastiga tittar.
Insjunken gammelmansmun har han, disig blick,
ryggen krummar tyngd av arbete och år.
Så tar han av sig mössan, ser upp.
Jag förstår av hans ansikte att han lyssnar inåt,
att han hör psalmsång, att orgeln brusar,
att något som legat gömt under tusen glömskor
återuppstår och lever i hans sinnen.
Barndop, vigsel, död.
Människolivets stolpar passerar.
Och jag som knappt har några religioner kvar
får vara med om en andakt bortom alla liturgier.`
  },
  {
    number: 2,
    lat: 60.6152,
    lng: 16.7848,
    title: "I åttan, där vevaxlarna...",
    description:
      "Vid ånghammaren nedanför Sandviks gamla huvudkontor finns dikten I åttan, där vevaxlarna... ur ”Sotfragment” (1949).",
    // I PDF heter denna sida "Ånghammaren" och texten börjar med "I åttan, där vevaxlarna..."
    poem: `I åttan, där vevaxlarna till oceanernas
Trampfartyg och de bländande vita passagerarångarna smiddes,
fanns det en reglerare, som lade sitt fickur på städet
och lät hammaren falla med full kraft – utan att krossa glaset.
Den känseln i fingrarna skulle kanske gjort honom till kirurg
eller varför inte urmakare?
Han var nästa ensam i världen om sitt konststycke.`
  },
  {
    number: 3,
    lat: 60.6160,
    lng: 16.7815,
    title: "Kärleksbrev",
    description:
      "Vid norra sluttningen ner mot Dal-Britas damm, sitter dikten Kärleksbrev, ur diktsamlingen ”Livets starka smak” (1974).",
    poem: `Klagar lommen på din sjö, övergiven?
Ack, då vet du att min längtan är för stor,
för att rymmas i bröstet.
Stiger ni ur sommarbåten med breda vita hattar
och låter skratten krusa sjön,
för att sedan glitterlikt bäras bort av vinden?
Är månen uppe och vaktar vid ditt fönster om kvällen,
borrar den hål i din rullgardin
med det solbrända herdelandskapet?
Hörde du min viskning, förmedlad av syrsan?

Jag vet ej riktigt vad som pågår här i ensamheten,
men jag läser dina brev i gräsets dagg
och skriver vers på havets vatten.
Jag kvider ofta, oförmodat, gråter, bär mig åt, hulkar, rasar.
Detta för att jag saknar dina ögon så,
Stjärnelika under hattens brätte,
brunnar där min törst kan släckas.
Ropar lommen på din sjö?
Då vet du hur mitt hjärta har det i sin heta smedja.`
  },
  {
    number: 4,
    lat: 60.6169185,
    lng: 16.7797732,
    title: "Bandvalsaren",
    description:
      "På gräsmattan, mitt emot entrén till Smedsgårdens museum, återfinns dikten Bandvalsaren, ur diktsamlingen ”Sotfragment” (1949).",
    poem: `Med sparsamhet och övertid drog han fram tre pojkar till studenten.
Han andades och levde genom dem, de blev trappor mot solen.
Själv har han aldrig varit på bio eller teater
eller haft tid att läsa böcker.
De har lyckats och kommer hem till helgerna
och talar med främmande röster om dessa ting.
Deras kvinnor har kalla ögon
och föraktar honom när han äter med kniv.
Han ska aldrig förstå vem som murat hans ensamhet.`
  },
  {
    number: 5,
    lat: 60.6150,
    lng: 16.7760,
    title: "Tvätterska",
    description:
      "Dikten Tvätterska, ur diktsamlingen ”Molnskugga” (1955), finns att läsa i parken nära kanalen vid Barrsätragatsbron.",
    poem: `Som vore smuts ondska dunkar hon vid klappbryggan,
vid vårens första vak och när björkar singlar sina löv om hösten.
Tidigt änka.
Hennes ansikte är utslätat av bykar, av lut, av löddrig såpa.
Det finns en fattigdomens bistra frost i hennes öga,
som inga tvättar tar.
Herre, se glad ut i din himmel, håll rent,
låt det dofta av rena sommarkläder när hon kommer!
Skura trappan med sand och göm den svarta blåställsfloden.
Ty det finns ej fläck i hennes öde.`
  },
  {
    number: 6,
    lat: 60.6190,
    lng: 16.7740,
    title: "Himlafrukost",
    description:
      "Dikten Himlafrukost ur ”Livets starka smak (1974) finns på slaggstensmuren till vänster bakom restaurangen The Church.",
    poem: `Jag tror nog att far min reder sig i himlen,
ty det är där han är om det är rättvist.
Den som alltid passar tiden
och gjort rätt för sig i över femtio år
bör få umgås med de andra änglabarnen.
Är det söndag gör han i ordning spicken sill,
han skär rejäla bitar på skärbrädan av äkta ceder.
Till detta färsk potatis, som själv kryper ur skalet,
en driva gräslök, sur tjock grädde.
Vilka mulliga kor i de ängderna!

En stor sup på bordet, källarsvalt öl,
hårt spisbröd med smör, nykärnat
och brett med stort slöseri.
En sådan himlafrukost unnar jag honom.
Till aftonvarden får han supanmat, eller välling,
kanske kornmjölsgröt, len som ängsull i magen.

Nog reder sig far min i himlen
bara han slipper kalla korkmattor.
På domedagen tar han emaljögat ur västfickan,
ty han är skötsam och håller styvt på ordning.
När han tar fram det torde även Gud rysa.`
  },
  {
    number: 7,
    lat: 60.6198,
    lng: 16.7730,
    title: "Sätt du fram ur sommarns nätta nyponskålar...",
    description:
      "Vid stadshuset, och Smedsgatans norra ände, finner du dikten Sätt du fram ur sommarns nätta nyponskålar..., från diktsamlingen ”Läkebok, nedresa” (1993).",
    poem: `Sätt du fram ur sommarns nätta nyponskålar
en dekokt på klarbär, smultron – extra mycket –
krasigt mos på hallon, även tistron,
späd med saliven från syren, kaprifol och andra nektargömm en,
rör tre motsolsvarv, låt stå och dra,
men ej mitt i solen, då förflyktigas aromen.
Smörj mina ögonlock därmed, fukta min tunga,
stryk min panna ren, nästla in av dessa livets safter
sju teskedar i taget i min mun.

De får inte vara större än de skedar som de små brukar
när de bosätter sig på baksidan av olvonbladen
och som de plägar nyttja innan hösten nyper till.
Välhängd gulmåra är gott därtill.
Missförstå mig inte, det rör doften, inte halmen.
Läs ur din stora Läkebok för mig, men gå varligt fram i texten.
Ty jag är förtappad i så motto att också kärleken har blivit skör,
den orkar knappt med tyngden av slåtterblommans kronblad, de ögonljusa.
Säg att det står i boken att vi vistas här en stund
innan skymningen tar överhanden
och att vi tecknar våra namn på det stora konvolutet
som en sista åtgärd.
Vad är det för fjärilsfladder, som nu tar plats bakom ögonlocken.`
  },
  {
    number: 8,
    lat: 60.6208395,
    lng: 16.7802191,
    title: "Anteckningar om arbetet",
    description:
      "Anteckningar om arbetet ingår i diktsamlingen ”Livets starka smak” (1974). Den finner du på muren vid konsthallens entré.",
    // I PDF står rubriken "Anteckningar kring arbetet" (innehållet är detta)
    poem: `Den orangefärgade röken från rostugnen står vackert mot vinterhimlen,
ett utropstecken som varslar om ekonomisk potens.
Den påstås vara ofarlig.
För övrigt måste människorna ha sin utkomst, ju.
Närma dig den stora, vibrerande maskinen till fots.
Då får du proportioner, den slukar nya km varje år.
Du hör hur det dova morret växer till larm.
Egentligen är ljuden ofarliga i sig, liksom det de representerar.
Likaså röken, även om snön blir apelsingul.

Bara man inte kommer i närheten,
bara man inte fumlar med maskinen och riskerar en lem,
bara man inte ställer sig i vägen för elden,
för fallande last, för alla verktyg och redskap och grejor,
som bearbetar människokött lika opersonligt som metaller.
Veterligen har industrialismen inte för avsikt att göra någon illa.
Gifter, rök, syror, gaser, damm och annat sattyg,
som oturligt nog råkar bli biprodukter
är inte illa menade eller avsedda att skada natur och människor.
Allting tillverkas med de bästa avsikter.
Den apelsinfärgade röken är endast ett bevis
för att idog kapitalinsamling pågår.
Antasta den avsikten om du kan!`
  }
];


  
      markers.forEach(m => createMarker(m));

      // Auto-zoom till alla punkter (inkl. userpos när den kommer)
      map.fitBounds(bounds);
      google.maps.event.addListenerOnce(map, "bounds_changed", () => {
        const maxZoom = 17;
        if (map.getZoom() > maxZoom) map.setZoom(maxZoom);
      });

      // Initiera enhetsposition
      enableGeolocation();

      // Lägg till kontroll för att rensa vägbeskrivning
      addClearRouteControl();
    }

    function createMarker(m) {
      const marker = new google.maps.Marker({
        map,
        position: { lat: m.lat, lng: m.lng },
        label: {
          text: String(m.number),
          color: "black",
          fontSize: "22px",
          fontWeight: "900",
          fontFamily: "Libre Baskerville",
        },
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          fillColor: "red",
          fillOpacity: 1,
          scale: 15,
          strokeColor: "black",
          strokeWeight: 0,
        },
        title: m.title
      });

      const content = `
        <div>
          <h2>${m.title}</h2>
          <p>${m.description}</p>
          <div class="poem-wrap">
            <div class="poem">${escapeHtml(m.poem)}</div>
          </div>
          #Läs dikten</a>
          <br/>
          <a href="#" class="route-to" data-lat="${m.lat}" data-lng="${m.lng}" titleer("click", () => {
        infoWindow.setContent(content);
        infoWindow.open(map, marker);
        google.maps.event.addListenerOnce(infoWindow, "domready", () => attachIWHandlers());
      });

      bounds.extend(marker.getPosition());
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }

    function attachIWHandlers() {
      const iw = document.querySelector(".gm-style-iw");
      if (!iw) return;

      const toggle = iw.querySelector(".toggle-poem");
      const wrap = iw.querySelector(".poem-wrap");
      if (toggle && wrap) {
        wrap.style.maxHeight = "0px";
        toggle.textContent = "Läs dikten";
        toggle.setAttribute("aria-expanded", "false");

        toggle.addEventListener("click", (e) => {
          e.preventDefault();
          const isOpen = wrap.style.maxHeight && wrap.style.maxHeight !== "0px";
          if (isOpen) {
            wrap.style.maxHeight = "0px";
            toggle.textContent = "Läs dikten";
            toggle.setAttribute("aria-expanded", "false");
          } else {
            wrap.style.maxHeight = wrap.scrollHeight + "px";
            toggle.textContent = "Dölj dikten";
            toggle.setAttribute("aria-expanded", "true");
          }
        });
      }

      const routeBtn = iw.querySelector(".route-to");
      if (routeBtn) {
        routeBtn.addEventListener("click", (e) => {
          e.preventDefault();
          const lat = parseFloat(routeBtn.dataset.lat);
          const lng = parseFloat(routeBtn.dataset.lng);
          routeToDestination({ lat, lng });
        });
      }
    }

    function enableGeolocation() {
      if (!navigator.geolocation) {
        console.warn("Geolokalisering stöds inte av denna webbläsare.");
        return;
      }

      // Första positionen
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          setUserPosition(pos);
        },
        (err) => {
          console.warn("Kunde inte hämta position:", err.message);
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );

      // Live-uppdatering
      navigator.geolocation.watchPosition(
        (pos) => {
          setUserPosition(pos, true);
        },
        (err) => {
          console.warn("WatchPosition-fel:", err.message);
        },
        { enableHighAccuracy: true, timeout: 20000, maximumAge: 5000 }
      );
    }

    function setUserPosition(pos, isUpdate = false) {
      const { latitude, longitude, accuracy } = pos.coords;
      userPos = { lat: latitude, lng: longitude };

      if (!userMarker) {
        userMarker = new google.maps.Marker({
          map,
          position: userPos,
          title: "Din position",
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            fillColor: "#1a73e8",
            fillOpacity: 1,
            scale: 8,
            strokeColor: "white",
            strokeWeight: 2,
          },
          zIndex: 999
        });

        accuracyCircle = new google.maps.Circle({
          map,
          center: userPos,
          radius: Math.max(accuracy || 30, 10),
          strokeColor: "#1a73e8",
          strokeOpacity: 0.8,
          strokeWeight: 1,
          fillColor: "#1a73e8",
          fillOpacity: 0.15,
          zIndex: 998
        });

        // Utöka bounds första gången
        bounds.extend(userMarker.getPosition());
        map.fitBounds(bounds);
      } else {
        userMarker.setPosition(userPos);
        accuracyCircle.setCenter(userPos);
        accuracyCircle.setRadius(Math.max(accuracy || 30, 10));
      }
    }

    function routeToDestination(dest) {
      if (!userPos) {
        alert("Din position är inte tillgänglig än. Tillåt platsåtkomst, och försök igen.");
        return;
      }

      const request = {
        origin: new google.maps.LatLng(userPos.lat, userPos.lng),
        destination: new google.maps.LatLng(dest.lat, dest.lng),
        travelMode: google.maps.TravelMode.WALKING,
        provideRouteAlternatives: false
      };

      directionsService.route(request, (result, status) => {
        if (status === google.maps.DirectionsStatus.OK) {
          directionsRenderer.setDirections(result);
          // Passa på att stänga diktrutan (valfritt)
          // infoWindow.close();
        } else {
          console.warn("Directions misslyckades:", status);
          alert("Kunde inte hämta vägbeskrivning. Testa igen, eller öppna i Google Maps.");
          // Fallback: öppna extern Google Maps vägbeskrivning
          const url = `https://www.google.com/maps/dir/?api=1&origin=${userPos.lat},${userPos.lng}&destination=${dest.lat},${dest.lng}&travelmode=walking`;
          window.open(url, "_blank");
        }
      });
    }

    function addClearRouteControl() {
      const controlDiv = document.createElement("div");
      controlDiv.className = "map-control";
      controlDiv.textContent = "Rensa vägbeskrivning";
      controlDiv.title = "Ta bort ritad gångväg";

      controlDiv.addEventListener("click", () => {
        directionsRenderer.setMap(null);
        directionsRenderer = new google.maps.DirectionsRenderer({
          map,
          suppressMarkers: false,
          preserveViewport: false,
          polylineOptions: { strokeColor: "#1976d2", strokeWeight: 5, strokeOpacity: 0.8 }
        });
      });

      map.controls[google.maps.ControlPosition.TOP_LEFT].push(controlDiv);
    }


    window.onload = function() {
      const script = document.createElement('script');
      // Förbättring #3: språk/region -> svenska/Sverige
      script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyDg3KLnpRbEjHD0Da-SidW12jU-Btr7fqM&language=sv&region=SE";
      script.async = true;
      script.defer = true;
      script.onload = initMap;
      document.head.appendChild(script);
    };
  </script>
</body>
</html>
